---
title: "Getting started with currentsee"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started with currentsee}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Welcome

The **currentsee** package simulates transitions between malaria intervention
packages and renders them as richly annotated Sankey diagrams. This vignette
takes you from simulation to interactive exploration so you can explore the
full workflow in just a few lines of code.

For package users the usual library call works:

```{r setup, echo=FALSE, message=FALSE}
library(currentsee)
library(dplyr)
```

## 1. Simulate transitions

We begin by simulating our data and adding a mock grouping variable "seasonality"

```{r simulate}
set.seed(1)
df <- simulate(100) |>
  mutate(
    season = sample(c("perennial", "seasonal"), 1),
    .by = "id"
  )

dplyr::glimpse(df)
```

The required columns include:

- **step** An integer vector. The current package is 0, steps down are negative and up are positive.
- **package** A character string indicating the name of the package specified as a
  comma separated concatenation of the interventions in the package. When rendering
  the sankey labels, individual interventions are stacked vertically.
- **changed** A character string indication which intervention is added or removed at each step.
- **id** A unqiue, interger identifier for each pathway

Additional columns are grouping variables. At a minimum, you will likely want to 
include the current package as a grouping variable.

The resulting data.frame records every step in each trajectory, including the
package string and which intervention changed.

## 2. Build Sankey inputs

Next we convert the raw simulation into the node and link structures required
by `networkD3::sankeyNetwork()`.

```{r build}
nodes <- make_nodes(df)
links <- make_links(df, nodes)

glimpse(nodes)
glimpse(links)
```

Nodes represent unique package combinations, while links count how often we
move from one combination to the next. Tooltips are automatically generated to
summarise which interventions were added or removed.

## 3. Create a static Sankey diagram

With the inputs prepared we can render an interactive Sankey diagram directly
in the RStudio viewer or an HTML document.

```{r sankey, out.width='100%'}
make_sankey(
  nodes, links, 
  nodeWidth = 40,
  fontSize = 12,
  height = "500px",
  width = "1000px"
)

```

The widget honours the colour palette produced by `make_colours()` and includes
rich tooltips describing each transition.

## 4. Launch the exploration Shiny app

To explore the same data with filtering controls, launch the bundled Shiny app.
This opens in your default browser and allows you to subset the trajectories by
any grouping columns you provide.

```{r shiny, eval = FALSE}
launch_step_app(df, group_cols = "season")
```

The app keeps the same Sankey rendering but adds dropdown selectors for the
`season` column, letting you compare perennial and seasonal pathways side by
side.
